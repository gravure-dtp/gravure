Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2012-12-31T15:05:02+01:00

====== Debian repository ======
Created lundi 31 décembre 2012

==== Debian repository ====
http://wiki.debian.org/SettingUpSignedAptRepositoryWithReprepro
http://wiki.debian.org/HowToSetupADebianRepository
http://www.isotton.com/software/debian/docs/repository-howto/repository-howto.html
http://dthconnex.com/debian_repository.htm

[[http://blog.jonliv.es/2011/04/26/creating-your-own-signed-apt-repository-and-debian-packages/|Creating your own Signed APT Repository and Debian Packages:]]

==== Mise en place du de l'apt repository ====

* génération d'une clé gpg pour la signature du catalogue du serveur
* export de la clé complète et copie par scp sur le serveur
* import gpg de la clé, puis effacement de la clé
* creation d'un volume lvm apt
* montage sur [[/apt]] et bind sur /srv/apache/var/www/apt
* création des répertoires 
	* /apt/debian
	* /apt/debian/conf
	* /apt/debian/tmp
	* /apt/debian/log
	* /apt/debian/morgue
	* /apt/debian/incoming
* chown serverobscur -R sur /apt/debian
* instalation de reprepro
* édition de [[/etc/apache2/sites-available/default,]] ajout d'un virtual host
   et de [[/etc/apache2/ports.confs]] ajout d'un listen pour le virtual host
* édition de [[/etc/shorewall/rules]]
* création de apt/debian/conf/distribution, options, release.override, incoming conf files
* export de la clef public sur le serveur :
	''gpg --armor --output dev@atelierobscur.org.gpg.key --export dev@atelierobscur.org''


=== signature automatique ===
* sur http://openpgp.vie-privee.org/gnupg-faq-fr.html un tuto que je comprends pas pour créer une cléf de signature sans passphrase
* gnupg-agent a trop de dependance, pas envie de l'installer sur le serveur
* donc pour le moment apt/debian/conf/option contient ask-passphrase

=== automatique incoming ===
* pas d'automatisme pour l'instant, posibilité par cron ou par [[http://packages.debian.org/inoticoming|inoticoming]] (pas clair) - http://man.devl.cz/man/1/inoticoming

=== déclencher processincoming ===

* copy par scp dans /apt/debian/incoming/
* connection ssh au serveur et cd [[/apt/debian]]
* reprepro processincoming wheezy

=== output ===

~~./conf/options:3: Ignoring too long (or incomplete) line.~~
~~Warning parsing config file '/apt/debian/conf/incoming', line '6': File ending without final LF!~~
~~Warning: There is a 'MorgueDir' but no 'Cleanup' to act on in rule 'wheezy'~~
~~Could not check validity of signature with 'EC9B72AB82C29938' in 'nemo_1.1.2-rc1_amd64.changes' as~~ ~~public key missing!~~
~~Missing line terminator in 'override.wheezy'!~~
~~Missing line terminator in 'override.wheezy'!~~
~~gpgme gave error GPGME:11:  Bad passphrase~~



